var net = require('net');

var peers = [];
var socketMap = {};
var lbConnection = net.createConnection(8124);

var messageHandlers = {
  listPeers: function(message){
    var peers = message.data.peers;
    for(var i in peers){
      var connection = net.createConnection(peer[i].port, peer[i].host);
    }
  }
  
  addPeer: function(message){
    peers.push(message.data.peer);
    console.log(peers);
  }
}

var onTcpReady = function(){
  var address = tcp.address();
  console.log("opened server on %j", address);
  
  //Ask the load balancer for list of peers
   var message = {type: 'identify', data: tcp.address()}
   lbConnection.write(JSON.stringify(message));
}

var tcp = net.createServer();

lbConnection.on('data', function(message){
  message = JSON.parse(message.toString());
  messageHandlers[message.type](message)
});

tcp.listen(onTcpReady);